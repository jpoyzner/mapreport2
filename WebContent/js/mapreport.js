define("utils/detector",["mobiledetect"],function(e){return new e(navigator.userAgent)}),define("collections/topics",["backbone"],function(e){return e.Collection.extend({initialize:function(){}})}),define("collections/locations",["backbone"],function(e){return e.Collection.extend({initialize:function(){}})}),define("collections/dates",["backbone"],function(e){return e.Collection.extend({initialize:function(){}})}),define("utils/color",["jquerycolor"],function(){return{random:function(){var e=12*Math.floor(30*Math.random());return $.Color({hue:e,saturation:.9,lightness:.8,alpha:1}).toHexString()},blue:"000080",yellow:"FFD700",gray:"708090",orange:"A0522D",green:"228B22",purple:"800080",white:"FFFFFF"}}),define("models/article",["utils/color","underscore","backbone"],function(e){return Backbone.Model.extend({initialize:function(t){var n;t.rootTopic,n=e.white,this.set("colorHex",n)}})}),define("utils/buildurl",[],function(){return function(e,t){var n=t.shift();return n&&(e+="?"+n,_.each(t,function(t){e+="&"+t})),e}}),define("collections/news",["collections/topics","collections/locations","collections/dates","models/article","utils/buildurl","utils/detector","underscore","backbone"],function(e,t,n,i,o,s){return Backbone.Collection.extend({model:i,initialize:function(e,t){this.rootUrl=e,t.topic&&(this.topic=t.topic),t.loc&&(this.loc=t.loc),t.date&&(this.date=t.date),t.mapBounds&&(this.mapBounds=t.mapBounds),t.search&&(this.search=t.search),this.fetches=0,this.on("request",_.bind(function(){this.fetches++},this)),this.fetch()},parse:function(i){if(this.fetches--,i.topics&&(this.topics=new e(i.topics.children)),i.locations&&(this.locations=new t(i.locations.children)),i.dates&&(this.dates=new n(i.dates.children)),this.radius=i.view.rectangle.clusterNewsRadius,this.topic||this.loc||this.date||this.mapBounds||this.search){var s=[];this.mapBounds&&s.push("left="+this.mapBounds.left,"right="+this.mapBounds.right,"top="+this.mapBounds.top,"bottom="+this.mapBounds.bottom),this.search&&s.push("search="+this.search),require("router").navigateTo(o((this.topic?"topic/"+this.topic:"")+(this.topic&&this.loc?"/":"")+(this.loc?"location/"+this.loc:"")+((this.topic||this.loc)&&this.date?"/":"")+(this.date?"date/"+this.date:""),s))}return i.news},url:function(){console.log("fetching map");var e=[];return this.mapBounds&&e.push("left="+this.mapBounds.left,"right="+this.mapBounds.right,"top="+this.mapBounds.top,"bottom="+this.mapBounds.bottom),this.localLat&&this.localLong&&e.push("local-lat="+this.localLat,"local-long="+this.localLong),this.topic&&e.push("topic="+encodeURI(this.topic)),this.loc&&e.push("location="+encodeURI(this.loc)),this.date&&e.push("date="+encodeURI(this.date)),this.search&&e.push("keywords="+this.search),s.phone()&&e.push("isMobile=true"),o(this.rootUrl+"news",e)}})}),define("utils/css",["utils/detector","jquery"],function(e){var t=$("head");return{load:function(n){t.append('<link rel="stylesheet" type="text/css" href="css/'+(e.phone()?"mobile/":"")+n+'.css">')}}}),define("components/options",["react","utils/css"],function(e,t){return e.createClass({getInitialState:function(){return t.load("options"),{}},render:function(){var t="http://www.mapreport.com/images/";return e.createElement("div",{id:"mr-options-bucket"},this.props.loading?e.createElement("span",{className:"header"},"Â MAPREPORT"):e.createElement("div",{id:"mr-options"},e.createElement("div",{className:"mr-option mr-topic-option",onClick:this.toggleMenu},e.createElement("span",{className:"mr-option-cell"},e.createElement("div",{className:"mr-option-title"},"TOPIC: ",decodeURI(this.props.news.topic)||"All Topics"),this.props.news.topics.models.map(function(n){return e.createElement("div",{onClick:this.updateTopic},e.createElement("img",{src:t+n.get("icon")}),e.createElement("span",null,e.createElement("span",null,n.get("node"))))}.bind(this)))),e.createElement("div",{className:"mr-option mr-location-option",onClick:this.toggleMenu},e.createElement("span",{className:"mr-option-cell"},e.createElement("div",{className:"mr-option-title"},"LOCATION: ",decodeURI(this.props.news.loc)||"All Locations"),this.props.news.locations.models.map(function(n){return e.createElement("div",{onClick:this.updateLocation},e.createElement("img",{src:t+n.get("icon")}),e.createElement("span",null,e.createElement("span",null,n.get("node"))))}.bind(this)))),e.createElement("div",{className:"mr-option mr-time-option",onClick:this.toggleMenu},e.createElement("span",{className:"mr-option-cell"},e.createElement("div",{className:"mr-option-title"},"TIME: ",decodeURI(this.props.news.date)||"Latest"),this.props.news.dates.models.map(function(n){return e.createElement("div",{onClick:this.updateTime},e.createElement("img",{src:t+n.get("icon")}),e.createElement("span",null,e.createElement("span",null,n.get("node"))))}.bind(this))))))},toggleMenu:function(e){$(e.currentTarget).toggleClass("mr-expanded")},updateTopic:function(e){this.props.news.topic=$(e.currentTarget).find("span span").html(),this.props.news.fetch()},updateLocation:function(e){this.props.news.loc=$(e.currentTarget).find("span span").html(),this.props.news.mapBounds=null,this.props.news.fetch()},updateTime:function(e){this.props.news.date=$(e.currentTarget).find("span span").html(),this.props.news.fetch()}})}),define("utils/spiderfy",[],function(){return function(e,t){if(e.length<2)return e;(t/=20)||(t=.03);var n={};_.each(e,function(e){var t=e.get("y")+","+e.get("x");n[t]||(n[t]=[]),n[t].push(e)});var i=[];return _.each(n,function(e){if(e.length>1)for(var n=0;n<e.length;n++){var o=e[n],s=1;2==e.length?s=.7:3==e.length&&(s=.85);var r=2*Math.PI*n/e.length;o.set("x",o.get("x")-t*Math.cos(r)*s),o.set("y",o.get("y")+t*Math.sin(r)*s*.65),i.push(o)}}),i}}),define("components/map",["react","utils/css","utils/spiderfy"],function(e,t,n){return e.createClass({getInitialState:function(){return window.mapComponent=this,window.initMap=function(){require(["richmarker"]);mapComponent.map=new google.maps.Map(document.getElementById("mr-map"),{center:{lat:37.7576793,lng:-122.5076404},streetViewControl:!1,mapTypeControl:!1,zoom:8}),google.maps.event.addListener(mapComponent.map,"zoom_changed",function(){var e=google.maps.event.addListener(mapComponent.map,"bounds_changed",function(t){this.getZoom()<1&&(mapComponent.readjustingZoom=!0,this.setZoom(1),mapComponent.readjustingZoom=!1),google.maps.event.removeListener(e)});mapComponent.props.loading||mapComponent.readjustingZoom||mapComponent.fittingBounds||mapComponent.fetchDataForNewBounds()}),google.maps.event.addListener(mapComponent.map,"dragend",mapComponent.fetchDataForNewBounds),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){mapComponent.curlat=e.coords.latitude,mapComponent.curlong=e.coords.longitude})},require(["gmaps"]),t.load("map"),{}},render:function(){return e.createElement("div",{id:"mr-map-bucket"},e.createElement("div",{id:"mr-map"}),e.createElement("div",{id:"mr-search"},e.createElement("input",{id:"mr-search-input"}),e.createElement("span",{id:"mr-search-action"},"Search"),e.createElement("span",{id:"mr-search-clear"},"X")),e.createElement("img",{id:"mr-curloc-button",src:"images/curloc.png"}))},componentDidMount:function(){var e=$("#mr-search-input");this.searchInput=e,e.keyup(function(t){13==t.keyCode&&(this.props.news.search=e.val(),this.props.news.fetch())}.bind(this)),$("#mr-search-action").show().click(function(){this.props.news.search=e.val(),this.props.news.fetch()}.bind(this)),$("#mr-search-clear").show().click(function(){this.props.news.search=null,e.val(""),this.props.news.fetch()}.bind(this)),$("#mr-curloc-button").show().click(function(){this.props.news.loc="Local",this.props.news.localLat=this.curlat,this.props.news.localLong=this.curlong,this.props.news.fetch()}.bind(this))},componentDidUpdate:function(){if(!this.props.loading){this.props.search&&this.searchInput.val(this.props.search),this.markers&&this.markers.length&&this.markers.map(function(e){e.setMap(null)}.bind(this)),this.markers=[];var e=new google.maps.LatLngBounds,t=[];this.props.news.models.reverse().map(function(n){if(n.get("isMapShow")){var i=new RichMarker({position:new google.maps.LatLng(n.get("y"),n.get("x")),map:this.map,anchor:RichMarkerPosition.MIDDLE,content:'<img class="mr-marker '+(n.get("isMain")?"mr-main-marker":"")+'" src="'+n.get("icon")+'" data-cid="'+n.cid+'" />',flat:!0,title:n.get("label")});n.set("marker",i),t.push(n),e.extend(i.getPosition()),i.addListener("click",function(){new google.maps.InfoWindow({content:'<a href="'+n.get("url")+'" target="_blank">'+n.get("dateTime")+" @ "+n.get("address")+": "+n.get("label")+"</a>"}).open(this.map,i)}.bind(this)),this.markers.push(i)}}.bind(this)),!this.mapMoved&&this.props.news.models.length&&(this.fittingBounds=!0,this.map.fitBounds(e),this.fittingBounds=!1),this.mapMoved=!1,setTimeout(function(){$(".mr-marker").off().hover(function(){clearInterval(window.page.cycleNewsInterval),$(".mr-marker").removeClass("mr-selected-marker"),$(".mr-report-article").removeClass("mr-selected-article");var e=$(this);e.addClass("mr-selected-marker");var t=$('.mr-report-article[data-cid="'+e.attr("data-cid")+'"]');t.length&&(t.addClass("mr-selected-article"),window.page.scrollTo(t))},function(){var e=$(this);e.removeClass("mr-selected-marker"),$('.mr-report-article[data-cid="'+e.attr("data-cid")+'"]').removeClass("mr-selected-article"),window.page.prepareNewsCycle()})},200)}},fetchDataForNewBounds:function(){this.mapMoved=!0;var e=this.map.getBounds(),t=e.getNorthEast(),n=e.getSouthWest();this.props.news.mapBounds={left:n.lng(),right:t.lng(),top:t.lat(),bottom:n.lat()},this.props.news.loc=void 0,this.props.news.fetch()}})}),define("components/report",["react","utils/css","utils/color"],function(e,t,n){return e.createClass({getInitialState:function(){return t.load("report"),{}},render:function(){return e.createElement("div",{id:"mr-report"},this.props.news.models.map(function(t){var n={color:t.get("color"),backgroundColor:"#"+t.get("colorHex")};return e.createElement("div",{className:"mr-report-article "+(t.get("isMain")?"mr-main-news":""),"data-cid":t.cid,style:n,onClick:this.goToArticle.bind(this,t)},e.createElement("img",{src:t.get("icon")}),t.get("video")?e.createElement("img",{className:"mr-video",src:"http://www.mapreport.com/images/common/video.jpg"}):"",e.createElement("p",null,t.get("dateTime"),": ",t.get("label")))}.bind(this)))},componentDidMount:function(){setTimeout(function(){$(".mr-report-article").off().hover(function(){clearInterval(window.page.cycleNewsInterval),$(".mr-marker").removeClass("mr-selected-marker");var e=$(this);e.addClass("mr-selected-article"),$('.mr-marker[data-cid="'+e.attr("data-cid")+'"]').addClass("mr-selected-marker")},function(){var e=$(this);e.removeClass("mr-selected-article"),$('.mr-marker[data-cid="'+e.attr("data-cid")+'"]').removeClass("mr-selected-marker"),window.page.prepareNewsCycle()})},200)},goToArticle:function(e,t){open(e.get($(t.target).is(".mr-video")?"video":"url"),"_blank")}})}),function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define("lib/spin",t):e.Spinner=t()}(this,function(){"use strict";function e(e,t){var n,i=document.createElement(e||"div");for(n in t)i[n]=t[n];return i}function t(e){for(var t=1,n=arguments.length;n>t;t++)e.appendChild(arguments[t]);return e}function n(e,t,n,i){var o=["opacity",t,~~(100*e),n,i].join("-"),s=.01+n/i*100,r=Math.max(1-(1-e)/t*(100-s),e),a=c.substring(0,c.indexOf("Animation")).toLowerCase(),p=a&&"-"+a+"-"||"";return d[o]||(l.insertRule("@"+p+"keyframes "+o+"{0%{opacity:"+r+"}"+s+"%{opacity:"+e+"}"+(s+.01)+"%{opacity:1}"+(s+t)%100+"%{opacity:"+e+"}100%{opacity:"+r+"}}",l.cssRules.length),d[o]=1),o}function i(e,t){var n,i,o=e.style;if(t=t.charAt(0).toUpperCase()+t.slice(1),void 0!==o[t])return t;for(i=0;i<p.length;i++)if(n=p[i]+t,void 0!==o[n])return n}function o(e,t){for(var n in t)e.style[i(e,n)||n]=t[n];return e}function s(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)void 0===e[i]&&(e[i]=n[i])}return e}function r(e,t){return"string"==typeof e?e:e[t%e.length]}function a(e){this.opts=s(e||{},a.defaults,h)}var c,l,p=["webkit","Moz","ms","O"],d={},h={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(a.defaults={},s(a.prototype,{spin:function(t){this.stop();var n=this,i=n.opts,s=n.el=e(null,{className:i.className});if(o(s,{position:i.position,width:0,zIndex:i.zIndex,left:i.left,top:i.top}),t&&t.insertBefore(s,t.firstChild||null),s.setAttribute("role","progressbar"),n.lines(s,n.opts),!c){var r,a=0,l=(i.lines-1)*(1-i.direction)/2,p=i.fps,d=p/i.speed,h=(1-i.opacity)/(d*i.trail/100),m=d/i.lines;!function e(){a++;for(var t=0;t<i.lines;t++)r=Math.max(1-(a+(i.lines-t)*m)%d*h,i.opacity),n.opacity(s,t*i.direction+l,r,i);n.timeout=n.el&&setTimeout(e,~~(1e3/p))}()}return n},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=void 0),this},lines:function(i,s){function a(t,n){return o(e(),{position:"absolute",width:s.scale*(s.length+s.width)+"px",height:s.scale*s.width+"px",background:t,boxShadow:n,transformOrigin:"left",transform:"rotate("+~~(360/s.lines*p+s.rotate)+"deg) translate("+s.scale*s.radius+"px,0)",borderRadius:(s.corners*s.scale*s.width>>1)+"px"})}for(var l,p=0,d=(s.lines-1)*(1-s.direction)/2;p<s.lines;p++)l=o(e(),{position:"absolute",top:1+~(s.scale*s.width/2)+"px",transform:s.hwaccel?"translate3d(0,0,0)":"",opacity:s.opacity,animation:c&&n(s.opacity,s.trail,d+p*s.direction,s.lines)+" "+1/s.speed+"s linear infinite"}),s.shadow&&t(l,o(a("#000","0 0 4px #000"),{top:"2px"})),t(i,t(l,a(r(s.color,p),"0 0 1px rgba(0,0,0,.1)")));return i},opacity:function(e,t,n){t<e.childNodes.length&&(e.childNodes[t].style.opacity=n)}}),"undefined"!=typeof document){l=function(){var n=e("style",{type:"text/css"});return t(document.getElementsByTagName("head")[0],n),n.sheet||n.styleSheet}();var m=o(e("group"),{behavior:"url(#default#VML)"});!i(m,"transform")&&m.adj?function(){function n(t,n){return e("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',n)}l.addRule(".spin-vml","behavior:url(#default#VML)"),a.prototype.lines=function(e,i){function s(){return o(n("group",{coordsize:p+" "+p,coordorigin:-l+" "+-l}),{width:p,height:p})}function a(e,a,c){t(h,t(o(s(),{rotation:360/i.lines*e+"deg",left:~~a}),t(o(n("roundrect",{arcsize:i.corners}),{width:l,height:i.scale*i.width,left:i.scale*i.radius,top:-i.scale*i.width>>1,filter:c}),n("fill",{color:r(i.color,e),opacity:i.opacity}),n("stroke",{opacity:0}))))}var c,l=i.scale*(i.length+i.width),p=2*i.scale*l,d=-(i.width+i.length)*i.scale*2+"px",h=o(s(),{position:"absolute",top:d,left:d});if(i.shadow)for(c=1;c<=i.lines;c++)a(c,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(c=1;c<=i.lines;c++)a(c);return t(e,h)},a.prototype.opacity=function(e,t,n,i){var o=e.firstChild;i=i.shadow&&i.lines||0,o&&t+i<o.childNodes.length&&(o=o.childNodes[t+i],o=o&&o.firstChild,(o=o&&o.firstChild)&&(o.opacity=n))}}():c=i(m,"animation")}return a}),define("components/page",["react","utils/detector","collections/news","components/options","components/map","components/report","lib/spin"],function(e,t,n,i,o,s,r){return e.createClass({getInitialState:function(){return window.page=this,new n("http://"+router.rootDomain+router.pathPrefix,router.settings).on("sync",function(e){this.setState({loading:!1,news:e,latitude:37.759753,longitude:-122.50232699999998,search:e.search})}.bind(this)).on("request",function(){this.setState({loading:!0})}.bind(this)),{loading:!0}},render:function(){return console.log(this.state.loading),e.createElement("div",{id:"mr-buckets",className:t.phone()?"mobile":"desktop"},e.createElement(i,{news:this.state.news,loading:this.state.loading}),e.createElement(o,{news:this.state.news,latitude:this.state.latitude,longitude:this.state.longitude,loading:this.state.loading,search:this.state.search}),e.createElement("div",{id:"mr-report-bucket"},this.state.loading?"":e.createElement(s,{news:this.state.news})),e.createElement("div",{id:"mr-spinner"}))},componentDidMount:function(){new r({color:"blue"}).spin($("#mr-spinner")[0]),setTimeout(function(){this.articleIndex=0,this.cycleNewsInterval=setInterval(this.cycleNews,5e3)}.bind(this),200)},componentDidUpdate:function(){$("#mr-spinner").css("display",this.state.loading?"static":"none")},prepareNewsCycle:function(){clearInterval(this.cycleNewsInterval),clearTimeout(this.cycleNewsTimeout),this.cycleNewsTimeout=setTimeout(function(){this.cycleNewsInterval=setInterval(this.cycleNews,5e3)}.bind(this),3e4)},cycleNews:function(){var e=$(".mr-report-article");this.articleIndex>=e.length&&(this.articleIndex=0),$(".mr-marker").removeClass("mr-selected-marker"),$(".mr-report-article").removeClass("mr-selected-article");var t=$(e[this.articleIndex]);t.length&&(t.addClass("mr-selected-article"),this.scrollTo(t)),$('.mr-marker[data-cid="'+t.attr("data-cid")+'"]').addClass("mr-selected-marker"),this.articleIndex++},scrollTo:function(e){var t=$("#mr-report-bucket"),n=e.position(),i=e.outerHeight(),o=t.scrollTop(),s=t.height(),r=n.top+o,a=.15*s;r<o?t.scrollTop(r-a):r+i>o+s&&t.scrollTop(r+i-s+a)}})}),define("router",["react","components/page","backbone"],function(e,t){return new(Backbone.Router.extend({initialize:function(){window.router=this;var e="pushState"in history;Backbone.history.start({pushState:e,hashChange:e})},routes:{"*path":"homePage"},homePage:function(n){this.rootDomain=document.domain+":8080",this.pathPrefix=-1===document.domain.indexOf("amazon")?"/mapreport-stable/":"/mapreport/";var i,o=location.pathname.split("/"),s=o.indexOf("topic")+1;s&&s<o.length&&(i=o[s]);var r,a=o.indexOf("location")+1;a&&a<o.length&&(r=o[a]);var c,l=o.indexOf("date")+1;l&&l<o.length&&(c=o[l]);var p,d,h,m,u;_.each(location.search.slice(1).split("&"),function(e){var t=e.split("=");"left"===t[0]?p=t[1]:"right"===t[0]?d=t[1]:"top"===t[0]?h=t[1]:"bottom"===t[0]?m=t[1]:"search"===t[0]&&(u=t[1])}),this.settings={topic:i,loc:r,date:c},p&&d&&h&&m&&(this.settings.mapBounds={left:p,right:d,top:h,bottom:m}),u&&(this.settings.search=u),"undefined"==typeof page?e.render(e.createElement(t),$("body")[0]):page.getInitialState()},redirectTo:function(e){location.href=e},navigateTo:function(e){this.navigate(this.pathPrefix+e)}}))}),requirejs.config({paths:{jquery:"//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min",jquerycolor:"//cdnjs.cloudflare.com/ajax/libs/jquery-color/2.1.2/jquery.color.min",underscore:"//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min",backbone:"//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min",react:"//cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react.min",mobiledetect:"//cdnjs.cloudflare.com/ajax/libs/mobile-detect/0.4.0/mobile-detect.min",richmarker:"lib/richmarker",spin:"lib/spin",gmaps:"//maps.googleapis.com/maps/api/js?key=AIzaSyCH89LosFbZ6Inmy5T8yCL0ao54qf2htCo&callback=initMap"},shim:{jquerycolor:{deps:["jquery"],exports:"jquerycolor"}}}),requirejs(["router"],function(e){}),define("mapreport",function(){});