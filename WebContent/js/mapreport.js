define("utils/detector",["mobiledetect"],function(t){return new t(navigator.userAgent)}),define("collections/topics",["backbone"],function(t){return t.Collection.extend({initialize:function(){}})}),define("collections/locations",["backbone"],function(t){return t.Collection.extend({initialize:function(){}})}),define("collections/dates",["backbone"],function(t){return t.Collection.extend({initialize:function(){}})}),define("utils/color",["jquerycolor"],function(){return{random:function(){var t=12*Math.floor(30*Math.random());return $.Color({hue:t,saturation:.9,lightness:.8,alpha:1}).toHexString()},blue:"000080",yellow:"FFD700",gray:"708090",orange:"A0522D",green:"228B22",purple:"800080",white:"FFFFFF"}}),define("models/article",["utils/color","underscore","backbone"],function(t){return Backbone.Model.extend({initialize:function(e){var n;switch(e.rootTopic){default:n=t.white}this.set("colorHex",n)}})}),define("utils/buildurl",[],function(){return function(t,e){var n=e.shift();return n&&(t+="?"+n,_.each(e,function(e){t+="&"+e})),t}}),define("collections/news",["collections/topics","collections/locations","collections/dates","models/article","utils/buildurl","utils/detector","underscore","backbone"],function(t,e,n,o,i,s){return Backbone.Collection.extend({model:o,initialize:function(t,e){this.rootUrl=t,e.topic&&(this.topic=e.topic),e.loc&&(this.loc=e.loc),e.date&&(this.date=e.date),e.mapBounds&&(this.mapBounds=e.mapBounds),e.search&&(this.search=e.search),this.fetches=0,this.on("request",_.bind(function(){this.fetches++},this)),this.fetch()},parse:function(o){if(this.fetches--,o.topics&&(this.topics=new t(o.topics.children)),o.locations&&(this.locations=new e(o.locations.children)),o.dates&&(this.dates=new n(o.dates.children)),this.radius=o.view.rectangle.clusterNewsRadius,this.topic||this.loc||this.date||this.mapBounds||this.search){var s=[];this.mapBounds&&s.push("left="+this.mapBounds.left,"right="+this.mapBounds.right,"top="+this.mapBounds.top,"bottom="+this.mapBounds.bottom),this.search&&s.push("search="+this.search),require("router").navigateTo(i((this.topic?"topic/"+this.topic:"")+(this.topic&&this.loc?"/":"")+(this.loc?"location/"+this.loc:"")+((this.topic||this.loc)&&this.date?"/":"")+(this.date?"date/"+this.date:""),s))}return o.news},url:function(){console.log("fetching map");var t=[];return this.mapBounds&&t.push("left="+this.mapBounds.left,"right="+this.mapBounds.right,"top="+this.mapBounds.top,"bottom="+this.mapBounds.bottom),this.localLat&&this.localLong&&t.push("local-lat="+this.localLat,"local-long="+this.localLong),this.topic&&t.push("topic="+encodeURI(this.topic)),this.loc&&t.push("location="+encodeURI(this.loc)),this.date&&t.push("date="+encodeURI(this.date)),this.search&&t.push("keywords="+this.search),s.phone()&&t.push("isMobile=true"),i(this.rootUrl+"news",t)}})}),define("utils/css",["utils/detector","jquery"],function(t){var e=$("head");return{load:function(n){e.append('<link rel="stylesheet" type="text/css" href="css/'+(t.phone()?"mobile/":"")+n+'.css">')}}}),define("components/options",["react","utils/css"],function(t,e){return t.createClass({getInitialState:function(){return e.load("options"),{}},render:function(){var e="http://www.mapreport.com/images/";return t.createElement("div",{id:"mr-options-bucket"},this.props.loading?t.createElement("span",{className:"header"},"Â MAPREPORT"):t.createElement("div",{id:"mr-options"},t.createElement("div",{className:"mr-option mr-topic-option",onClick:this.toggleMenu},t.createElement("span",{className:"mr-option-cell"},t.createElement("div",{className:"mr-option-title"},"TOPIC: ",this.props.news.topic||"All Topics"),this.props.news.topics.models.map(function(n){return t.createElement("div",{onClick:this.updateTopic},t.createElement("img",{src:e+n.get("icon")}),t.createElement("span",null,t.createElement("span",null,n.get("node"))))}.bind(this)))),t.createElement("div",{className:"mr-option mr-location-option",onClick:this.toggleMenu},t.createElement("span",{className:"mr-option-cell"},t.createElement("div",{className:"mr-option-title"},"LOCATION: ",this.props.news.loc||"All Locations"),this.props.news.locations.models.map(function(n){return t.createElement("div",{onClick:this.updateLocation},t.createElement("img",{src:e+n.get("icon")}),t.createElement("span",null,t.createElement("span",null,n.get("node"))))}.bind(this)))),t.createElement("div",{className:"mr-option mr-time-option",onClick:this.toggleMenu},t.createElement("span",{className:"mr-option-cell"},t.createElement("div",{className:"mr-option-title"},"TIME: ",this.props.news.date||"Latest"),this.props.news.dates.models.map(function(n){return t.createElement("div",{onClick:this.updateTime},t.createElement("img",{src:e+n.get("icon")}),t.createElement("span",null,t.createElement("span",null,n.get("node"))))}.bind(this))))))},toggleMenu:function(t){$(t.currentTarget).toggleClass("mr-expanded")},updateTopic:function(t){this.props.news.topic=$(t.currentTarget).find("span span").html(),this.props.news.fetch()},updateLocation:function(t){this.props.news.loc=$(t.currentTarget).find("span span").html(),this.props.news.mapBounds=null,this.props.news.fetch()},updateTime:function(t){this.props.news.date=$(t.currentTarget).find("span span").html(),this.props.news.fetch()}})}),define("utils/spiderfy",[],function(){return function(t,e){if(t.length<2)return t;e/=20,e||(e=.03);var n={};_.each(t,function(t){var e=t.get("y")+","+t.get("x");n[e]||(n[e]=[]),n[e].push(t)});var o=[];return _.each(n,function(t){if(t.length>1)for(var n=0;n<t.length;n++){var i=t[n],s=1;2==t.length?s=.7:3==t.length&&(s=.85);var r=2*Math.PI*n/t.length;i.set("x",i.get("x")-e*Math.cos(r)*s),i.set("y",i.get("y")+e*Math.sin(r)*s*.65),o.push(i)}}),o}}),define("components/map",["react","utils/css","utils/spiderfy"],function(t,e,n){return t.createClass({getInitialState:function(){return window.mapComponent=this,window.initMap=function(){require(["richmarker"]);var t=37.7576793,e=-122.5076404;mapComponent.map=new google.maps.Map(document.getElementById("mr-map"),{center:{lat:t,lng:e},streetViewControl:!1,mapTypeControl:!1,zoom:8}),google.maps.event.addListener(mapComponent.map,"zoom_changed",function(){var t=google.maps.event.addListener(mapComponent.map,"bounds_changed",function(e){this.getZoom()<1&&(mapComponent.readjustingZoom=!0,this.setZoom(1),mapComponent.readjustingZoom=!1),google.maps.event.removeListener(t)});mapComponent.props.loading||mapComponent.readjustingZoom||mapComponent.fittingBounds||mapComponent.fetchDataForNewBounds()}),google.maps.event.addListener(mapComponent.map,"dragend",mapComponent.fetchDataForNewBounds),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){mapComponent.curlat=t.coords.latitude,mapComponent.curlong=t.coords.longitude})},require(["gmaps"]),e.load("map"),{}},render:function(){return t.createElement("div",{id:"mr-map-bucket"},t.createElement("div",{id:"mr-map"}),t.createElement("div",{id:"mr-search"},t.createElement("input",{id:"mr-search-input"}),t.createElement("span",{id:"mr-search-action"},"Search"),t.createElement("span",{id:"mr-search-clear"},"X")),t.createElement("img",{id:"mr-curloc-button",src:"images/curloc.png"}))},componentDidMount:function(){var t=$("#mr-search-input");this.searchInput=t,t.keyup(function(e){13==e.keyCode&&(this.props.news.search=t.val(),this.props.news.fetch())}.bind(this)),$("#mr-search-action").show().click(function(){this.props.news.search=t.val(),this.props.news.fetch()}.bind(this)),$("#mr-search-clear").show().click(function(){this.props.news.search=null,t.val(""),this.props.news.fetch()}.bind(this)),$("#mr-curloc-button").show().click(function(){this.props.news.loc="Local",this.props.news.localLat=this.curlat,this.props.news.localLong=this.curlong,this.props.news.fetch()}.bind(this))},componentDidUpdate:function(){if(!this.props.loading){this.props.search&&this.searchInput.val(this.props.search),this.markers&&this.markers.length&&this.markers.map(function(t){t.setMap(null)}.bind(this)),this.markers=[];var t=new google.maps.LatLngBounds,e=[];this.props.news.models.reverse().map(function(n){if(n.get("isMapShow")){var o=new RichMarker({position:new google.maps.LatLng(n.get("y"),n.get("x")),map:this.map,anchor:RichMarkerPosition.MIDDLE,content:'<img class="mr-marker '+(n.get("isMain")?"mr-main-marker":"")+'" src="'+n.get("icon")+'" />',flat:!0,title:n.get("label")});n.set("marker",o),e.push(n),t.extend(o.getPosition()),o.addListener("click",function(){new google.maps.InfoWindow({content:'<a href="'+n.get("url")+'" target="_blank">'+n.get("dateTime")+" @ "+n.get("address")+": "+n.get("label")+"</a>"}).open(this.map,o)}.bind(this)),this.markers.push(o)}}.bind(this)),!this.mapMoved&&this.props.news.models.length&&(this.fittingBounds=!0,this.map.fitBounds(t),this.fittingBounds=!1),this.mapMoved=!1}},fetchDataForNewBounds:function(){this.mapMoved=!0;var t=this.map.getBounds(),e=t.getNorthEast(),n=t.getSouthWest();this.props.news.mapBounds={left:n.lng(),right:e.lng(),top:e.lat(),bottom:n.lat()},this.props.news.loc=void 0,this.props.news.fetch()}})}),define("components/report",["react","utils/css","utils/color"],function(t,e,n){return t.createClass({getInitialState:function(){return e.load("report"),{}},render:function(){return t.createElement("div",{id:"mr-report"},this.props.news.models.map(function(e){var n={color:e.get("color"),backgroundColor:"#"+e.get("colorHex")};return t.createElement("div",{className:"mr-report-article "+(e.get("isMain")?"mr-main-news":""),style:n,onClick:this.goToArticle.bind(this,e)},t.createElement("img",{src:e.get("icon")}),e.get("video")?t.createElement("img",{className:"mr-video",src:"http://www.mapreport.com/images/common/video.jpg"}):"",t.createElement("p",null,e.get("dateTime"),": ",e.get("label")))}.bind(this)))},goToArticle:function(t,e){open(t.get($(e.target).is(".mr-video")?"video":"url"),"_blank")}})}),!function(t,e){"object"==typeof module&&module.exports?module.exports=e():"function"==typeof define&&define.amd?define("lib/spin",e):t.Spinner=e()}(this,function(){function t(t,e){var n,o=document.createElement(t||"div");for(n in e)o[n]=e[n];return o}function e(t){for(var e=1,n=arguments.length;n>e;e++)t.appendChild(arguments[e]);return t}function n(t,e,n,o){var i=["opacity",e,~~(100*t),n,o].join("-"),s=.01+n/o*100,r=Math.max(1-(1-t)/e*(100-s),t),a=l.substring(0,l.indexOf("Animation")).toLowerCase(),c=a&&"-"+a+"-"||"";return d[i]||(p.insertRule("@"+c+"keyframes "+i+"{0%{opacity:"+r+"}"+s+"%{opacity:"+t+"}"+(s+.01)+"%{opacity:1}"+(s+e)%100+"%{opacity:"+t+"}100%{opacity:"+r+"}}",p.cssRules.length),d[i]=1),i}function o(t,e){var n,o,i=t.style;if(e=e.charAt(0).toUpperCase()+e.slice(1),void 0!==i[e])return e;for(o=0;o<u.length;o++)if(n=u[o]+e,void 0!==i[n])return n}function i(t,e){for(var n in e)t.style[o(t,n)||n]=e[n];return t}function s(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)void 0===t[o]&&(t[o]=n[o])}return t}function r(t,e){return"string"==typeof t?t:t[e%t.length]}function a(t){this.opts=s(t||{},a.defaults,h)}function c(){function n(e,n){return t("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',n)}p.addRule(".spin-vml","behavior:url(#default#VML)"),a.prototype.lines=function(t,o){function s(){return i(n("group",{coordsize:p+" "+p,coordorigin:-l+" "+-l}),{width:p,height:p})}function a(t,a,c){e(d,e(i(s(),{rotation:360/o.lines*t+"deg",left:~~a}),e(i(n("roundrect",{arcsize:o.corners}),{width:l,height:o.scale*o.width,left:o.scale*o.radius,top:-o.scale*o.width>>1,filter:c}),n("fill",{color:r(o.color,t),opacity:o.opacity}),n("stroke",{opacity:0}))))}var c,l=o.scale*(o.length+o.width),p=2*o.scale*l,u=-(o.width+o.length)*o.scale*2+"px",d=i(s(),{position:"absolute",top:u,left:u});if(o.shadow)for(c=1;c<=o.lines;c++)a(c,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(c=1;c<=o.lines;c++)a(c);return e(t,d)},a.prototype.opacity=function(t,e,n,o){var i=t.firstChild;o=o.shadow&&o.lines||0,i&&e+o<i.childNodes.length&&(i=i.childNodes[e+o],i=i&&i.firstChild,i=i&&i.firstChild,i&&(i.opacity=n))}}var l,p,u=["webkit","Moz","ms","O"],d={},h={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(a.defaults={},s(a.prototype,{spin:function(e){this.stop();var n=this,o=n.opts,s=n.el=t(null,{className:o.className});if(i(s,{position:o.position,width:0,zIndex:o.zIndex,left:o.left,top:o.top}),e&&e.insertBefore(s,e.firstChild||null),s.setAttribute("role","progressbar"),n.lines(s,n.opts),!l){var r,a=0,c=(o.lines-1)*(1-o.direction)/2,p=o.fps,u=p/o.speed,d=(1-o.opacity)/(u*o.trail/100),h=u/o.lines;!function m(){a++;for(var t=0;t<o.lines;t++)r=Math.max(1-(a+(o.lines-t)*h)%u*d,o.opacity),n.opacity(s,t*o.direction+c,r,o);n.timeout=n.el&&setTimeout(m,~~(1e3/p))}()}return n},stop:function(){var t=this.el;return t&&(clearTimeout(this.timeout),t.parentNode&&t.parentNode.removeChild(t),this.el=void 0),this},lines:function(o,s){function a(e,n){return i(t(),{position:"absolute",width:s.scale*(s.length+s.width)+"px",height:s.scale*s.width+"px",background:e,boxShadow:n,transformOrigin:"left",transform:"rotate("+~~(360/s.lines*p+s.rotate)+"deg) translate("+s.scale*s.radius+"px,0)",borderRadius:(s.corners*s.scale*s.width>>1)+"px"})}for(var c,p=0,u=(s.lines-1)*(1-s.direction)/2;p<s.lines;p++)c=i(t(),{position:"absolute",top:1+~(s.scale*s.width/2)+"px",transform:s.hwaccel?"translate3d(0,0,0)":"",opacity:s.opacity,animation:l&&n(s.opacity,s.trail,u+p*s.direction,s.lines)+" "+1/s.speed+"s linear infinite"}),s.shadow&&e(c,i(a("#000","0 0 4px #000"),{top:"2px"})),e(o,e(c,a(r(s.color,p),"0 0 1px rgba(0,0,0,.1)")));return o},opacity:function(t,e,n){e<t.childNodes.length&&(t.childNodes[e].style.opacity=n)}}),"undefined"!=typeof document){p=function(){var n=t("style",{type:"text/css"});return e(document.getElementsByTagName("head")[0],n),n.sheet||n.styleSheet}();var m=i(t("group"),{behavior:"url(#default#VML)"});!o(m,"transform")&&m.adj?c():l=o(m,"animation")}return a}),define("components/page",["react","utils/detector","collections/news","components/options","components/map","components/report","lib/spin"],function(t,e,n,o,i,s,r){return t.createClass({getInitialState:function(){return window.page=this,new n("http://"+router.rootDomain+router.pathPrefix,router.settings).on("sync",function(t){this.setState({loading:!1,news:t,latitude:37.759753,longitude:-122.50232699999998,search:t.search})}.bind(this)).on("request",function(){this.setState({loading:!0})}.bind(this)),{loading:!0}},render:function(){return console.log(this.state.loading),t.createElement("div",{id:"mr-buckets",className:e.phone()?"mobile":"desktop"},t.createElement(o,{news:this.state.news,loading:this.state.loading}),t.createElement(i,{news:this.state.news,latitude:this.state.latitude,longitude:this.state.longitude,loading:this.state.loading,search:this.state.search}),t.createElement("div",{id:"mr-report-bucket"},this.state.loading?"":t.createElement(s,{news:this.state.news})),t.createElement("div",{id:"mr-spinner"}))},componentDidMount:function(){new r({color:"blue"}).spin($("#mr-spinner")[0])},componentDidUpdate:function(){$("#mr-spinner").css("display",this.state.loading?"static":"none")}})}),define("router",["react","components/page","backbone"],function(t,e){return new(Backbone.Router.extend({initialize:function(){window.router=this;var t="pushState"in history;Backbone.history.start({pushState:t,hashChange:t})},routes:{"*path":"homePage"},homePage:function(n){this.rootDomain=document.domain+":8080",this.pathPrefix=-1===document.domain.indexOf("amazon")?"/mapreport-stable/":"/mapreport/";var o,i=location.pathname.split("/"),s=i.indexOf("topic")+1;s&&s<i.length&&(o=i[s]);var r,a=i.indexOf("location")+1;a&&a<i.length&&(r=i[a]);var c,l=i.indexOf("date")+1;l&&l<i.length&&(c=i[l]);var p,u,d,h,m;_.each(location.search.slice(1).split("&"),function(t){var e=t.split("=");"left"===e[0]?p=e[1]:"right"===e[0]?u=e[1]:"top"===e[0]?d=e[1]:"bottom"===e[0]?h=e[1]:"search"===e[0]&&(m=e[1])}),this.settings={topic:o,loc:r,date:c},p&&u&&d&&h&&(this.settings.mapBounds={left:p,right:u,top:d,bottom:h}),m&&(this.settings.search=m),"undefined"==typeof page?t.render(t.createElement(e),$("body")[0]):page.getInitialState()},redirectTo:function(t){location.href=t},navigateTo:function(t){this.navigate(this.pathPrefix+t)}}))}),requirejs.config({paths:{jquery:"//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min",jquerycolor:"//cdnjs.cloudflare.com/ajax/libs/jquery-color/2.1.2/jquery.color.min",underscore:"//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min",backbone:"//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min",react:"//cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react.min",mobiledetect:"//cdnjs.cloudflare.com/ajax/libs/mobile-detect/0.4.0/mobile-detect.min",richmarker:"lib/richmarker",spin:"lib/spin",gmaps:"//maps.googleapis.com/maps/api/js?key=AIzaSyCH89LosFbZ6Inmy5T8yCL0ao54qf2htCo&callback=initMap"},shim:{jquerycolor:{deps:["jquery"],exports:"jquerycolor"}}}),requirejs(["router"],function(t){}),define("mapreport",function(){});