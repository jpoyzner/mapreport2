define("utils/detector",["mobiledetect"],function(t){return new t(navigator.userAgent)}),define("templates",["jquery","underscore"],function(){var t={};return $(".template").each(function(){t[this.id]=_.template(this.innerHTML)}),t}),define("collections/topics",["backbone"],function(t){return t.Collection.extend({initialize:function(){}})}),define("collections/locations",["backbone"],function(t){return t.Collection.extend({initialize:function(){}})}),define("collections/dates",["backbone"],function(t){return t.Collection.extend({initialize:function(){}})}),define("utils/color",["jquerycolor"],function(){return{random:function(){var t=12*Math.floor(30*Math.random());return $.Color({hue:t,saturation:.9,lightness:.8,alpha:1}).toHexString()},blue:"000080",yellow:"FFD700",gray:"708090",orange:"A0522D",green:"228B22",purple:"800080",white:"FFFFFF"}}),define("models/article",["utils/color","underscore","backbone"],function(t){return Backbone.Model.extend({initialize:function(e){var i;switch(e.rootTopic){case"Business":i=t.blue;break;case"Disasters":i=t.yellow;break;case"Politics":i=t.gray;break;case"Crime":i=t.orange;break;case"Sports":i=t.green;break;case"Science & Education":i=t.purple;break;default:i=t.white}this.set("colorHex",i)}})}),define("utils/buildurl",[],function(){return function(t,e){var i=e.shift();return i&&(t+="?"+i,_.each(e,function(e){t+="&"+e})),t}}),define("utils/spiderfy",[],function(){return function(t,e){if(!e||t.length<2)return t;var i=void 0,n=void 0,o=void 0,s=void 0,a={};_.each(t,function(t){var r=t.x+","+t.x;a[r]||(a[r]=[]),a[r].push(t),e||((!i||t.x<i)&&(i=t.x),(!n||t.x>n)&&(n=t.x),(!o||t.y>o)&&(o=t.y),(!s||t.y<s)&&(s=t.y))});var r,c;if(e)r=(e.right-e.left)/10,c=(e.top-e.bottom)/10;else var r=.5,c=.5;return _.each(a,function(t){if(t.length>1)for(var e=0;e<t.length;e++){var i=t[e];i.x-=r*Math.cos(2*Math.PI*e/t.length),i.y+=c*Math.sin(2*Math.PI*e/t.length)}}),t}}),define("collections/news",["collections/topics","collections/locations","collections/dates","models/article","utils/buildurl","utils/spiderfy","underscore","backbone"],function(t,e,i,n,o,s){return Backbone.Collection.extend({model:n,initialize:function(t,e){this.rootUrl=t,e.topic&&(this.topic=e.topic),e.loc&&(this.loc=e.loc),e.date&&(this.date=e.date),e.mapBounds&&(this.mapBounds=e.mapBounds),this.fetches=0,this.on("request",_.bind(function(){this.fetches++},this)),this.fetch()},parse:function(n){return this.fetches--,n.topics&&(this.topics=new t(n.topics.children)),n.locations&&(this.locations=new e(n.locations.children)),n.dates&&(this.dates=new i(n.dates.children)),s(n.news,this.mapBounds),(this.topic||this.loc||this.date||this.mapBounds)&&require("router").navigateTo((this.topic?"topic/"+this.topic:"")+(this.topic&&this.loc?"/":"")+(this.loc?"location/"+this.loc:"")+((this.topic||this.loc)&&this.date?"/":"")+(this.date?"date/"+this.date:"")+(this.mapBounds?o("",["left="+this.mapBounds.left,"right="+this.mapBounds.right,"top="+this.mapBounds.top,"bottom="+this.mapBounds.bottom]):"")),this.optionsChanging(),n.news},url:function(){console.log("fetching map");var t;return t=[],this.mapBounds&&t.push("left="+this.mapBounds.left,"right="+this.mapBounds.right,"top="+this.mapBounds.top,"bottom="+this.mapBounds.bottom),this.topic&&t.push("topic="+encodeURI(this.topic)),this.loc&&t.push("location="+encodeURI(this.loc)),this.date&&t.push("date="+encodeURI(this.date)),o(this.rootUrl+"news",t)},optionsChanging:function(){this.mapReloading=!0,setTimeout(_.bind(function(){this.mapReloading=!1},this),500)}})}),define("utils/css",["utils/detector","jquery"],function(t){var e=$("head");return{load:function(i){e.append('<link rel="stylesheet" type="text/css" href="css/'+(t.phone()?"mobile/":"")+i+'.css">')}}}),define("views/Map",["templates","utils/css","backbone","underscore"],function(t,e){return Backbone.View.extend({initialize:function(i){this.news=i.news,this.latitude=i.latitude,this.longitude=i.longitude,e.load("map"),this.map=$("#mr-map-bucket").html(t["mr-map-template"]({latitude:this.latitude,longitude:this.longitude})).find("google-map"),this.map.on("google-map-ready",_.bind(function(t){var e=_.bind(this.mapUpdated,this,t);window.google.maps.event.addListener(t.target.map,"dragend",e),window.google.maps.event.addListener(t.target.map,"zoom_changed",_.after(3,e))},this)),this.listenTo(this.news,"sync",this.populateMarkers)},populateMarkers:function(){this.news.fetches||(this.news.mapReloading||this.map.attr("fitToMarkers",""),this.map[0].clear(),this.map.html(t["mr-map-markers-template"]({news:this.news,latitude:this.latitude,longitude:this.longitude})))},mapUpdated:function(t){if(!this.news.mapReloading){var e=t.target.map.getBounds(),i=e.getNorthEast(),n=e.getSouthWest();this.news.fetching=!0,this.news.mapBounds={left:n.lng(),right:i.lng(),top:i.lat(),bottom:n.lat()},this.news.loc=void 0,this.map.removeAttr("fitToMarkers"),this.news.fetch()}}})}),define("views/Options",["templates","utils/css","backbone","underscore"],function(t,e){return Backbone.View.extend({initialize:function(t){e.load("options"),this.news=t.news,this.bucket=$("#mr-options-bucket"),this.listenTo(t.news,"request",this.refresh),this.listenTo(t.news,"sync",this.render)},refresh:function(){this.bucket.html('<span class="header">&nbsp;MAPREPORT</span>')},render:function(){if(!this.news.fetches){this.bucket.html(t["mr-options-template"](this.news));var e=$(".mr-option");e.click(function(t){if(!this.expanded&&$(t.target).is("input-options"))return void(this.expanded=!this.expanded);var e=document.createEvent("MouseEvents");e.initMouseEvent(this.expanded?"collapse":"mousedown",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),$(this).find("input-options")[0].dispatchEvent(e),this.expanded=!this.expanded}),$(e[0]).find("input-options").on("action-fired",_.bind(function(t){this.news.topic=t.target.value_,this.news.optionsChanging(),this.news.fetch()},this)),$(e[1]).find("input-options").on("action-fired",_.bind(function(t){this.news.loc=t.target.value_,this.news.optionsChanging(),this.news.fetch()},this)),$(e[2]).find("input-options").on("action-fired",_.bind(function(t){this.news.date=t.target.value_,this.news.optionsChanging(),this.news.fetch()},this))}}})}),define("views/Report",["templates","utils/css","utils/color","backbone","underscore"],function(t,e,i){return Backbone.View.extend({initialize:function(t){e.load("report"),this.news=t.news,this.bucket=$("#mr-report-bucket"),this.listenTo(this.news,"request",this.refresh),this.listenTo(this.news,"sync",this.render)},refresh:function(){this.bucket.html('<web-loader type="clock" color="white"></web-loader>')},render:function(){this.news.fetches||this.bucket.html(t["mr-report-template"]({news:this.news}))}})}),define("router",["utils/detector","templates","collections/news","views/Map","views/Options","views/Report","jquery","backbone"],function(t,e,i,n,o,s){return new(Backbone.Router.extend({initialize:function(){var t="pushState"in history;Backbone.history.start({pushState:t,hashChange:t})},routes:{"*path":"homePage"},homePage:function(a){$("body").html(e["mr-template"]({platform:t.phone()?"mobile":"desktop"}));var r=document.domain+":8080";this.pathPrefix=-1===document.domain.indexOf("amazon")?"/mapreport-stable/":"/mapreport/";var c,l=location.pathname.split("/"),h=l.indexOf("topic")+1;h&&h<l.length&&(c=l[h]);var u,d=l.indexOf("location")+1;d&&d<l.length&&(u=l[d]);var p,f=l.indexOf("date")+1;f&&f<l.length&&(p=l[f]);var m,b,g,w;_.each(location.search.slice(1).split("&"),function(t){var e=t.split("=");"left"===e[0]?m=e[1]:"right"===e[0]?b=e[1]:"top"===e[0]?g=e[1]:"bottom"===e[0]&&(w=e[1])});var v={topic:c,loc:u,date:p};m&&b&&g&&w&&(v.mapBounds={left:m,right:b,top:g,bottom:w});var k=new i("http://"+r+this.pathPrefix,v);new n({news:k,latitude:37.759753,longitude:-122.50232699999998}),new o({news:k}),new s({news:k})},redirectTo:function(t){location.href=t},navigateTo:function(t){this.navigate(this.pathPrefix+t)}}))}),requirejs.config({paths:{jquery:"//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min",jquerycolor:"//cdnjs.cloudflare.com/ajax/libs/jquery-color/2.1.2/jquery.color.min",underscore:"//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min",backbone:"//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min",mobiledetect:"//cdnjs.cloudflare.com/ajax/libs/mobile-detect/0.4.0/mobile-detect.min"},shim:{jquerycolor:{deps:["jquery"],exports:"jquerycolor"}}}),requirejs(["router"],function(){}),define("mapreport",function(){});