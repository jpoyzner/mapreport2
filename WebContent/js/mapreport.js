define("utils/detector",["mobiledetect"],function(e){return new e(navigator.userAgent)}),define("collections/topics",["backbone"],function(e){return e.Collection.extend({initialize:function(){}})}),define("collections/locations",["backbone"],function(e){return e.Collection.extend({initialize:function(){}})}),define("collections/dates",["backbone"],function(e){return e.Collection.extend({initialize:function(){}})}),define("utils/color",["jquerycolor"],function(){return{random:function(){var e=12*Math.floor(30*Math.random());return $.Color({hue:e,saturation:.9,lightness:.8,alpha:1}).toHexString()},blue:"000080",yellow:"FFD700",gray:"708090",orange:"A0522D",green:"228B22",purple:"800080",white:"FFFFFF"}}),define("models/article",["utils/color","underscore","backbone"],function(e){return Backbone.Model.extend({initialize:function(t){var n,o="black";switch(t.rootTopic){case"Business":o="white",n=e.blue;break;case"Disasters":n=e.yellow;break;case"Politics":o="white",n=e.gray;break;case"Crime":n=e.orange;break;case"Sports":n=e.green;break;case"Science & Education":n=e.purple;break;default:n=e.white}this.set("color",o),this.set("colorHex",n)}})}),define("utils/buildurl",[],function(){return function(e,t){var n=t.shift();return n&&(e+="?"+n,_.each(t,function(t){e+="&"+t})),e}}),define("collections/news",["collections/topics","collections/locations","collections/dates","models/article","utils/buildurl","utils/detector","underscore","backbone"],function(e,t,n,o,i,s){return Backbone.Collection.extend({model:o,initialize:function(e,t){this.rootUrl=e,t.topic&&(this.topic=t.topic),t.loc&&(this.loc=t.loc),t.date&&(this.date=t.date),t.mapBounds&&(this.mapBounds=t.mapBounds),t.search&&(this.search=t.search),this.fetches=0,this.on("request",_.bind(function(){this.fetches++},this)),this.fetch()},parse:function(o){if(this.fetches--,o.topics&&(this.topics=new e(o.topics.children)),o.locations&&(this.locations=new t(o.locations.children)),o.dates&&(this.dates=new n(o.dates.children)),this.radius=o.view.rectangle.clusterNewsRadius,this.topic||this.loc||this.date||this.mapBounds||this.search){var s=[];this.mapBounds&&s.push("left="+this.mapBounds.left,"right="+this.mapBounds.right,"top="+this.mapBounds.top,"bottom="+this.mapBounds.bottom),this.search&&s.push("search="+this.search),require("router").navigateTo(i((this.topic?"topic/"+this.topic:"")+(this.topic&&this.loc?"/":"")+(this.loc?"location/"+this.loc:"")+((this.topic||this.loc)&&this.date?"/":"")+(this.date?"date/"+this.date:""),s))}return o.news},url:function(){console.log("fetching map");var e=[];return this.mapBounds&&e.push("left="+this.mapBounds.left,"right="+this.mapBounds.right,"top="+this.mapBounds.top,"bottom="+this.mapBounds.bottom),this.localLat&&this.localLong&&e.push("local-lat="+this.localLat,"local-long="+this.localLong),this.topic&&e.push("topic="+encodeURI(this.topic)),this.loc&&e.push("location="+encodeURI(this.loc)),this.date&&e.push("date="+encodeURI(this.date)),this.search&&e.push("keywords="+this.search),s.phone()&&e.push("isMobile=true"),i(this.rootUrl+"news",e)}})}),define("utils/css",["utils/detector","jquery"],function(e){var t=$("head");return{load:function(n){t.append('<link rel="stylesheet" type="text/css" href="css/'+(e.phone()?"mobile/":"")+n+'.css">')}}}),define("components/options",["react","utils/css"],function(e,t){return e.createClass({getInitialState:function(){return t.load("options"),{}},render:function(){return e.createElement("div",{id:"mr-options-bucket"},this.props.loading?e.createElement("span",{className:"header"},"Â MAPREPORT"):e.createElement("div",{id:"mr-options"},e.createElement("div",{className:"mr-option mr-topic-option",onClick:this.toggleMenu},e.createElement("span",{className:"mr-option-cell"},e.createElement("span",null,"TOPIC: ",this.props.news.topic||"All Topics"),this.props.news.topics.models.map(function(t){return e.createElement("div",{onClick:this.updateTopic},t.get("node"))}.bind(this)))),e.createElement("div",{className:"mr-option mr-location-option",onClick:this.toggleMenu},e.createElement("span",{className:"mr-option-cell"},e.createElement("span",null,"LOCATION: ",this.props.news.loc||"All Locations"),this.props.news.locations.models.map(function(t){return e.createElement("div",{onClick:this.updateLocation},t.get("node"))}.bind(this)))),e.createElement("div",{className:"mr-option mr-time-option",onClick:this.toggleMenu},e.createElement("span",{className:"mr-option-cell"},e.createElement("span",null,"TIME: ",this.props.news.date||"All Time"),this.props.news.dates.models.map(function(t){return e.createElement("div",{onClick:this.updateTime},t.get("node"))}.bind(this))))))},toggleMenu:function(e){$(e.currentTarget).toggleClass("mr-expanded")},updateTopic:function(e){this.props.news.topic=$(e.target).html(),this.props.news.fetch()},updateLocation:function(e){this.props.news.loc=$(e.target).html(),this.props.news.mapBounds=null,this.props.news.fetch()},updateTime:function(e){this.props.news.date=$(e.target).html(),this.props.news.fetch()}})}),define("utils/spiderfy",[],function(){return function(e,t){if(e.length<2)return e;t/=20,t||(t=.03);var n={};_.each(e,function(e){var t=e.get("y")+","+e.get("x");n[t]||(n[t]=[]),n[t].push(e)});var o=[];return _.each(n,function(e){if(e.length>1)for(var n=0;n<e.length;n++){var i=e[n],s=1;2==e.length?s=.7:3==e.length&&(s=.85);var a=2*Math.PI*n/e.length;i.set("x",i.get("x")-t*Math.cos(a)*s),i.set("y",i.get("y")+t*Math.sin(a)*s*.65),o.push(i)}}),o}}),define("components/map",["react","utils/css","utils/spiderfy"],function(e,t,n){return e.createClass({getInitialState:function(){return window.mapComponent=this,window.initMap=function(){var e=37.7576793,t=-122.5076404;mapComponent.map=new google.maps.Map(document.getElementById("mr-map"),{center:{lat:e,lng:t},streetViewControl:!1,mapTypeControl:!1,zoom:8}),google.maps.event.addListener(mapComponent.map,"zoom_changed",function(){var e=google.maps.event.addListener(mapComponent.map,"bounds_changed",function(t){this.getZoom()<1&&(mapComponent.readjustingZoom=!0,this.setZoom(1),mapComponent.readjustingZoom=!1),google.maps.event.removeListener(e)});mapComponent.props.loading||mapComponent.readjustingZoom||mapComponent.fittingBounds||mapComponent.fetchDataForNewBounds()}),google.maps.event.addListener(mapComponent.map,"dragend",mapComponent.fetchDataForNewBounds),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){mapComponent.curlat=e.coords.latitude,mapComponent.curlong=e.coords.longitude})},require(["gmaps"]),t.load("map"),{}},render:function(){return e.createElement("div",{id:"mr-map-bucket"},e.createElement("div",{id:"mr-map"}),e.createElement("div",{id:"mr-search"},e.createElement("input",{id:"mr-search-input"}),e.createElement("span",{id:"mr-search-action"},"Search"),e.createElement("span",{id:"mr-search-clear"},"X")),e.createElement("img",{id:"mr-curloc-button",src:"images/curloc.png"}))},componentDidMount:function(){var e=$("#mr-search-input");this.searchInput=e,e.keyup(function(t){13==t.keyCode&&(this.props.news.search=e.val(),this.props.news.fetch())}.bind(this)),$("#mr-search-action").show().click(function(){this.props.news.search=e.val(),this.props.news.fetch()}.bind(this)),$("#mr-search-clear").show().click(function(){this.props.news.search=null,e.val(""),this.props.news.fetch()}.bind(this)),$("#mr-curloc-button").show().click(function(){this.props.news.loc="Local",this.props.news.localLat=this.curlat,this.props.news.localLong=this.curlong,this.props.news.fetch()}.bind(this))},componentDidUpdate:function(){if(!this.props.loading){this.props.search&&this.searchInput.val(this.props.search),this.markers&&this.markers.length&&this.markers.map(function(e){e.setMap(null)}.bind(this)),this.markers=[];var e=new google.maps.LatLngBounds,t=[];this.props.news.models.map(function(n){if(n.get("isMapShow")){var o=new google.maps.Marker({position:new google.maps.LatLng(n.get("y"),n.get("x")),map:this.map,icon:n.get("icon"),title:n.get("label")});n.set("marker",o),t.push(n),e.extend(o.getPosition()),o.addListener("click",function(){new google.maps.InfoWindow({content:'<a href="'+n.get("url")+'" target="_blank">'+n.get("dateTime")+" @ "+n.get("address")+": "+n.get("label")+"</a>"}).open(this.map,o)}.bind(this)),this.markers.push(o)}}.bind(this)),!this.mapMoved&&this.props.news.models.length&&(this.fittingBounds=!0,this.map.fitBounds(e),n(t,this.props.news.radius).map(function(e){var t=e.get("marker"),n=this.markers.indexOf(t);-1!==n&&(t.setMap(null),this.markers.splice(n,1));var o=new google.maps.Marker({position:new google.maps.LatLng(e.get("y"),e.get("x")),map:this.map,icon:e.get("icon"),title:e.get("label")});o.addListener("click",function(){new google.maps.InfoWindow({content:'<a href="'+e.get("url")+'" target="_blank">'+e.get("dateTime")+" @ "+e.get("address")+": "+e.get("label")+"</a>"}).open(this.map,o)}.bind(this))}.bind(this)),this.fittingBounds=!1),this.mapMoved=!1}},fetchDataForNewBounds:function(){this.mapMoved=!0;var e=this.map.getBounds(),t=e.getNorthEast(),n=e.getSouthWest();this.props.news.mapBounds={left:n.lng(),right:t.lng(),top:t.lat(),bottom:n.lat()},this.props.news.loc=void 0,this.props.news.fetch()}})}),define("components/report",["react","utils/css","utils/color"],function(e,t,n){return e.createClass({getInitialState:function(){return t.load("report"),{}},render:function(){return e.createElement("div",{id:"mr-report"},this.props.news.models.map(function(t){var n={color:t.get("color"),backgroundColor:"#"+t.get("colorHex")};return e.createElement("div",{className:"mr-report-article",style:n,onClick:this.goToArticle.bind(this,t)},e.createElement("img",{src:t.get("icon")}),t.get("video")?e.createElement("img",{className:"mr-video",src:"http://www.mapreport.com/images/common/video.jpg"}):"",e.createElement("p",null,t.get("dateTime"),": ",t.get("label")))}.bind(this)))},goToArticle:function(e,t){open(e.get($(t.target).is(".mr-video")?"video":"url"),"_blank")}})}),define("components/page",["react","utils/detector","collections/news","components/options","components/map","components/report"],function(e,t,n,o,i,s){return e.createClass({getInitialState:function(){return window.page=this,new n("http://"+router.rootDomain+router.pathPrefix,router.settings).on("sync",function(e){this.setState({loading:e.fetches,news:e,latitude:37.759753,longitude:-122.50232699999998,search:e.search})}.bind(this)).on("request",function(){this.setState({loading:!0})}.bind(this)),{loading:!0}},render:function(){return e.createElement("div",{id:"mr-buckets",className:t.phone()?"mobile":"desktop"},e.createElement(o,{news:this.state.news,loading:this.state.loading}),e.createElement(i,{news:this.state.news,latitude:this.state.latitude,longitude:this.state.longitude,loading:this.state.loading,search:this.state.search}),e.createElement("div",{id:"mr-report-bucket"},this.state.loading?"LOADER":e.createElement(s,{news:this.state.news})))}})}),define("router",["react","components/page","backbone"],function(e,t){return new(Backbone.Router.extend({initialize:function(){window.router=this;var e="pushState"in history;Backbone.history.start({pushState:e,hashChange:e})},routes:{"*path":"homePage"},homePage:function(n){this.rootDomain=document.domain+":8080",this.pathPrefix=-1===document.domain.indexOf("amazon")?"/mapreport-stable/":"/mapreport/";var o,i=location.pathname.split("/"),s=i.indexOf("topic")+1;s&&s<i.length&&(o=i[s]);var a,r=i.indexOf("location")+1;r&&r<i.length&&(a=i[r]);var c,l=i.indexOf("date")+1;l&&l<i.length&&(c=i[l]);var p,h,u,d,m;_.each(location.search.slice(1).split("&"),function(e){var t=e.split("=");"left"===t[0]?p=t[1]:"right"===t[0]?h=t[1]:"top"===t[0]?u=t[1]:"bottom"===t[0]?d=t[1]:"search"===t[0]&&(m=t[1])}),this.settings={topic:o,loc:a,date:c},p&&h&&u&&d&&(this.settings.mapBounds={left:p,right:h,top:u,bottom:d}),m&&(this.settings.search=m),"undefined"==typeof page?e.render(e.createElement(t),$("body")[0]):page.getInitialState()},redirectTo:function(e){location.href=e},navigateTo:function(e){this.navigate(this.pathPrefix+e)}}))}),requirejs.config({paths:{jquery:"//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min",jquerycolor:"//cdnjs.cloudflare.com/ajax/libs/jquery-color/2.1.2/jquery.color.min",underscore:"//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min",backbone:"//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min",react:"//cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react.min",mobiledetect:"//cdnjs.cloudflare.com/ajax/libs/mobile-detect/0.4.0/mobile-detect.min",gmaps:"//maps.googleapis.com/maps/api/js?key=AIzaSyCH89LosFbZ6Inmy5T8yCL0ao54qf2htCo&callback=initMap"},shim:{jquerycolor:{deps:["jquery"],exports:"jquerycolor"}}}),requirejs(["router"],function(e){}),define("mapreport",function(){});