define("utils/detector",["mobiledetect"],function(e){return new e(navigator.userAgent)}),define("collections/topics",["backbone"],function(e){return e.Collection.extend({initialize:function(){}})}),define("collections/locations",["backbone"],function(e){return e.Collection.extend({initialize:function(){}})}),define("collections/dates",["backbone"],function(e){return e.Collection.extend({initialize:function(){}})}),define("utils/color",["jquerycolor"],function(){return{random:function(){var e=12*Math.floor(30*Math.random());return $.Color({hue:e,saturation:.9,lightness:.8,alpha:1}).toHexString()},blue:"000080",yellow:"FFD700",gray:"708090",orange:"A0522D",green:"228B22",purple:"800080",white:"FFFFFF"}}),define("models/article",["utils/color","underscore","backbone"],function(e){return Backbone.Model.extend({initialize:function(t){var n;switch(t.rootTopic){case"Business":n=e.blue;break;case"Disasters":n=e.yellow;break;case"Politics":n=e.gray;break;case"Crime":n=e.orange;break;case"Sports":n=e.green;break;case"Science & Education":n=e.purple;break;default:n=e.white}this.set("colorHex",n)}})}),define("utils/buildurl",[],function(){return function(e,t){var n=t.shift();return n&&(e+="?"+n,_.each(t,function(t){e+="&"+t})),e}}),define("utils/spiderfy",[],function(){return function(e,t){if(!t||e.length<2)return e;var n=void 0,o=void 0,i=void 0,s=void 0,a={};_.each(e,function(e){var r=e.x+","+e.x;a[r]||(a[r]=[]),a[r].push(e),t||((!n||e.x<n)&&(n=e.x),(!o||e.x>o)&&(o=e.x),(!i||e.y>i)&&(i=e.y),(!s||e.y<s)&&(s=e.y))});var r,c;if(t)r=(t.right-t.left)/10,c=(t.top-t.bottom)/10;else var r=.5,c=.5;return _.each(a,function(e){if(e.length>1)for(var t=0;t<e.length;t++){var n=e[t];n.x-=r*Math.cos(2*Math.PI*t/e.length),n.y+=c*Math.sin(2*Math.PI*t/e.length)}}),e}}),define("collections/news",["collections/topics","collections/locations","collections/dates","models/article","utils/buildurl","utils/spiderfy","underscore","backbone"],function(e,t,n,o,i,s){return Backbone.Collection.extend({model:o,initialize:function(e,t){this.rootUrl=e,t.topic&&(this.topic=t.topic),t.loc&&(this.loc=t.loc),t.date&&(this.date=t.date),t.mapBounds&&(this.mapBounds=t.mapBounds),this.fetches=0,this.on("request",_.bind(function(){this.fetches++},this)),this.fetch()},parse:function(o){return this.fetches--,o.topics&&(this.topics=new e(o.topics.children)),o.locations&&(this.locations=new t(o.locations.children)),o.dates&&(this.dates=new n(o.dates.children)),s(o.news,this.mapBounds),(this.topic||this.loc||this.date||this.mapBounds)&&require("router").navigateTo((this.topic?"topic/"+this.topic:"")+(this.topic&&this.loc?"/":"")+(this.loc?"location/"+this.loc:"")+((this.topic||this.loc)&&this.date?"/":"")+(this.date?"date/"+this.date:"")+(this.mapBounds?i("",["left="+this.mapBounds.left,"right="+this.mapBounds.right,"top="+this.mapBounds.top,"bottom="+this.mapBounds.bottom]):"")),this.optionsChanging(),o.news},url:function(){console.log("fetching map");var e;return e=[],this.mapBounds&&e.push("left="+this.mapBounds.left,"right="+this.mapBounds.right,"top="+this.mapBounds.top,"bottom="+this.mapBounds.bottom),this.topic&&e.push("topic="+encodeURI(this.topic)),this.loc&&e.push("location="+encodeURI(this.loc)),this.date&&e.push("date="+encodeURI(this.date)),i(this.rootUrl+"news",e)},optionsChanging:function(){this.mapReloading=!0,setTimeout(_.bind(function(){this.mapReloading=!1},this),500)}})}),define("components/options",["react"],function(e,t,n,o,i,s){return e.createClass({render:function(){return e.createElement("div",{id:"mr-options-bucket"},e.createElement("span",{className:"header"},"Â MAPREPORT"))}})}),define("utils/css",["utils/detector","jquery"],function(e){var t=$("head");return{load:function(n){t.append('<link rel="stylesheet" type="text/css" href="css/'+(e.phone()?"mobile/":"")+n+'.css">')}}}),define("components/map",["react","utils/css"],function(e,t){return e.createClass({getInitialState:function(){return window.mapComponent=this,window.initMap=function(){var e=37.7576793,t=-122.5076404;this.props&&(e=this.props.latitude,t=this.props.longitude),mapComponent.map=new google.maps.Map(document.getElementById("mr-map"),{center:{lat:e,lng:t},zoom:8}),google.maps.event.addListener(mapComponent.map,"zoom_changed",function(){var e=google.maps.event.addListener(mapComponent.map,"bounds_changed",function(t){this.getZoom()<1&&this.setZoom(1),google.maps.event.removeListener(e)})})},require(["gmaps"]),t.load("map"),{}},render:function(){return e.createElement("div",{id:"mr-map-bucket"},e.createElement("div",{id:"mr-map"}))},componentDidUpdate:function(){if(this.props.news){var e=new google.maps.LatLngBounds;this.props.news.models.map(function(t){var n=new google.maps.Marker({position:new google.maps.LatLng(t.get("x"),t.get("y")),map:this.map,icon:t.get("icon"),title:t.get("label")});e.extend(n.getPosition()),n.addListener("click",function(){new google.maps.InfoWindow({content:'<a href="'+t.get("url")+'" target="_blank">'+t.get("dateTime")+" @ "+t.get("address")+": "+t.get("label")+"</a>"}).open(this.map,n)}.bind(this))}.bind(this)),this.props.news.models.length&&this.map.fitBounds(e)}}})}),define("components/report",["react","utils/css","utils/color"],function(e,t,n){return e.createClass({getInitialState:function(){return t.load("report"),{}},render:function(){return e.createElement("div",{id:"mr-report"},this.props.news.models.map(function(t){return e.createElement("div",{className:"mr-report-article",style:{backgroundColor:"#"+t.get("colorHex")}},e.createElement("img",{src:t.get("icon")}),e.createElement("a",{href:t.get("url"),target:"_blank"},e.createElement("p",null),t.get("mapLabel"),": ",t.get("dateTime"),": ",t.get("label"),e.createElement("p",null)))}))}})}),define("router",["backbone"],function(e){return new(Backbone.Router.extend({initialize:function(){var e="pushState"in history;Backbone.history.start({pushState:e,hashChange:e})},routes:{"*path":"homePage"},homePage:function(e){this.rootDomain=document.domain+":8080",this.pathPrefix=-1===document.domain.indexOf("amazon")?"/mapreport-stable/":"/mapreport/";var t,n=location.pathname.split("/"),o=n.indexOf("topic")+1;o&&o<n.length&&(t=n[o]);var i,s=n.indexOf("location")+1;s&&s<n.length&&(i=n[s]);var a,r=n.indexOf("date")+1;r&&r<n.length&&(a=n[r]);var c,l,u,d;_.each(location.search.slice(1).split("&"),function(e){var t=e.split("=");"left"===t[0]?c=t[1]:"right"===t[0]?l=t[1]:"top"===t[0]?u=t[1]:"bottom"===t[0]&&(d=t[1])}),this.settings={topic:t,loc:i,date:a},c&&l&&u&&d&&(this.settings.mapBounds={left:c,right:l,top:u,bottom:d})},redirectTo:function(e){location.href=e},navigateTo:function(e){this.navigate(this.pathPrefix+e)}}))}),define("components/page",["react","utils/detector","collections/news","components/options","components/map","components/report","router"],function(e,t,n,o,i,s,a){return e.createClass({getInitialState:function(){return window.page=this,new n("http://"+a.rootDomain+a.pathPrefix,a.settings).on("sync",function(e){this.setState({loading:!1,news:e,latitude:37.759753,longitude:-122.50232699999998})}.bind(this)).on("request",function(){this.setState({loading:!0})}.bind(this)),{loading:!0}},render:function(){return e.createElement("div",{id:"mr-buckets",className:t.phone()?"mobile":"desktop"},e.createElement(o,{news:this.state.news}),e.createElement(i,{news:this.state.news,latitude:this.state.latitude,longitude:this.state.longitude}),e.createElement("div",{id:"mr-report-bucket"},this.state.loading||this.state.news.fetches?"LOADER":e.createElement(s,{news:this.state.news})))}})}),requirejs.config({paths:{jquery:"//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min",jquerycolor:"//cdnjs.cloudflare.com/ajax/libs/jquery-color/2.1.2/jquery.color.min",underscore:"//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min",backbone:"//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min",react:"//cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react",mobiledetect:"//cdnjs.cloudflare.com/ajax/libs/mobile-detect/0.4.0/mobile-detect.min",gmaps:"//maps.googleapis.com/maps/api/js?key=AIzaSyCH89LosFbZ6Inmy5T8yCL0ao54qf2htCo&callback=initMap"},shim:{jquerycolor:{deps:["jquery"],exports:"jquerycolor"}}}),requirejs(["jquery","react","components/page"],function(e,t,n){t.render(t.createElement(n),e("body")[0])}),define("mapreport",function(){});