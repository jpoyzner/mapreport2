define("utils/detector",["mobiledetect"],function(t){return new t(navigator.userAgent)}),define("collections/topics",["backbone"],function(t){return t.Collection.extend({initialize:function(){}})}),define("collections/locations",["backbone"],function(t){return t.Collection.extend({initialize:function(){}})}),define("collections/dates",["backbone"],function(t){return t.Collection.extend({initialize:function(){}})}),define("utils/color",["jquerycolor"],function(){return{random:function(){var t=12*Math.floor(30*Math.random());return $.Color({hue:t,saturation:.9,lightness:.8,alpha:1}).toHexString()},blue:"000080",yellow:"FFD700",gray:"708090",orange:"A0522D",green:"228B22",purple:"800080",white:"FFFFFF"}}),define("models/article",["utils/color","underscore","backbone"],function(t){return Backbone.Model.extend({initialize:function(e){var n;switch(e.rootTopic){case"Business":n=t.blue;break;case"Disasters":n=t.yellow;break;case"Politics":n=t.gray;break;case"Crime":n=t.orange;break;case"Sports":n=t.green;break;case"Science & Education":n=t.purple;break;default:n=t.white}this.set("colorHex",n)}})}),define("utils/buildurl",[],function(){return function(t,e){var n=e.shift();return n&&(t+="?"+n,_.each(e,function(e){t+="&"+e})),t}}),define("utils/spiderfy",[],function(){return function(t,e){if(!e||t.length<2)return t;var n=void 0,o=void 0,i=void 0,s=void 0,a={};_.each(t,function(t){var r=t.x+","+t.x;a[r]||(a[r]=[]),a[r].push(t),e||((!n||t.x<n)&&(n=t.x),(!o||t.x>o)&&(o=t.x),(!i||t.y>i)&&(i=t.y),(!s||t.y<s)&&(s=t.y))});var r,c;if(e)r=(e.right-e.left)/10,c=(e.top-e.bottom)/10;else var r=.5,c=.5;return _.each(a,function(t){if(t.length>1)for(var e=0;e<t.length;e++){var n=t[e];n.x-=r*Math.cos(2*Math.PI*e/t.length),n.y+=c*Math.sin(2*Math.PI*e/t.length)}}),t}}),define("collections/news",["collections/topics","collections/locations","collections/dates","models/article","utils/buildurl","utils/spiderfy","underscore","backbone"],function(t,e,n,o,i,s){return Backbone.Collection.extend({model:o,initialize:function(t,e){this.rootUrl=t,e.topic&&(this.topic=e.topic),e.loc&&(this.loc=e.loc),e.date&&(this.date=e.date),e.mapBounds&&(this.mapBounds=e.mapBounds),this.fetches=0,this.on("request",_.bind(function(){this.fetches++},this)),this.fetch()},parse:function(o){return this.fetches--,o.topics&&(this.topics=new t(o.topics.children)),o.locations&&(this.locations=new e(o.locations.children)),o.dates&&(this.dates=new n(o.dates.children)),s(o.news,this.mapBounds),(this.topic||this.loc||this.date||this.mapBounds)&&require("router").navigateTo((this.topic?"topic/"+this.topic:"")+(this.topic&&this.loc?"/":"")+(this.loc?"location/"+this.loc:"")+((this.topic||this.loc)&&this.date?"/":"")+(this.date?"date/"+this.date:"")+(this.mapBounds?i("",["left="+this.mapBounds.left,"right="+this.mapBounds.right,"top="+this.mapBounds.top,"bottom="+this.mapBounds.bottom]):"")),o.news},url:function(){console.log("fetching map");var t=[];return this.mapBounds&&t.push("left="+this.mapBounds.left,"right="+this.mapBounds.right,"top="+this.mapBounds.top,"bottom="+this.mapBounds.bottom),this.topic&&t.push("topic="+encodeURI(this.topic)),this.loc&&t.push("location="+encodeURI(this.loc)),this.date&&t.push("date="+encodeURI(this.date)),i(this.rootUrl+"news",t)}})}),define("utils/css",["utils/detector","jquery"],function(t){var e=$("head");return{load:function(n){e.append('<link rel="stylesheet" type="text/css" href="css/'+(t.phone()?"mobile/":"")+n+'.css">')}}}),define("components/options",["react","utils/css"],function(t,e){return t.createClass({getInitialState:function(){return e.load("options"),{}},render:function(){return t.createElement("div",{id:"mr-options-bucket"},this.props.loading?t.createElement("span",{className:"header"},"Â MAPREPORT"):t.createElement("div",{id:"mr-options"},t.createElement("div",{className:"mr-option mr-topic-option"},t.createElement("span",{className:"mr-option-cell"},t.createElement("span",null,"TOPIC: ",this.props.news.topic||"All Topics"),this.props.news.topics.models.map(function(e){return t.createElement("div",null,e.get("node"))}))),t.createElement("div",{className:"mr-option mr-location-option"},t.createElement("span",{className:"mr-option-cell"},t.createElement("span",null,"LOCATION: ",this.props.news.loc||"Global"),this.props.news.locations.models.map(function(e){return t.createElement("div",null,e.get("node"))}))),t.createElement("div",{className:"mr-option mr-time-option"},t.createElement("span",{className:"mr-option-cell"},t.createElement("span",null,"TIME: ",this.props.news.date||"All Time"),this.props.news.dates.models.map(function(e){return t.createElement("div",null,e.get("node"))})))))},componentDidUpdate:function(){var t=$(".mr-option");t.click(function(t){$(t.currentTarget).toggleClass("mr-expanded")}),$(t[0]).find("div").click(function(t){this.props.news.topic=$(t.target).html(),this.props.news.fetch()}.bind(this)),$(t[1]).find("div").click(function(t){this.props.news.loc=$(t.target).html(),this.props.news.fetch()}.bind(this)),$(t[2]).find("div").click(function(t){this.props.news.date=$(t.target).html(),this.props.news.fetch()}.bind(this))}})}),define("components/map",["react","utils/css"],function(t,e){return t.createClass({getInitialState:function(){return window.mapComponent=this,window.initMap=function(){var t=37.7576793,e=-122.5076404;mapComponent.map=new google.maps.Map(document.getElementById("mr-map"),{center:{lat:t,lng:e},streetViewControl:!1,zoom:8}),google.maps.event.addListener(mapComponent.map,"zoom_changed",function(){var t=google.maps.event.addListener(mapComponent.map,"bounds_changed",function(e){this.getZoom()<1&&(mapComponent.readjustingZoom=!0,this.setZoom(1),mapComponent.readjustingZoom=!1),google.maps.event.removeListener(t)});mapComponent.props.loading||mapComponent.readjustingZoom||mapComponent.fittingBounds||mapComponent.fetchDataForNewBounds()}),google.maps.event.addListener(mapComponent.map,"dragend",mapComponent.fetchDataForNewBounds),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){mapComponent.curlat=t.coords.latitude,mapComponent.curlong=t.coords.longitude})},require(["gmaps"]),e.load("map"),{}},render:function(){return t.createElement("div",{id:"mr-map-bucket"},t.createElement("div",{id:"mr-map"}),t.createElement("div",{id:"mr-curloc-button"}))},componentDidMount:function(){$("#mr-curloc-button").show().click(function(){alert(this.curlat+" "+this.curlong)}.bind(this))},componentDidUpdate:function(){if(!this.props.loading){this.markers&&this.markers.length&&this.markers.map(function(t){t.setMap(null)}.bind(this)),this.markers=[];var t=new google.maps.LatLngBounds;this.props.news.models.map(function(e){var n=new google.maps.Marker({position:new google.maps.LatLng(e.get("y"),e.get("x")),map:this.map,icon:e.get("icon"),title:e.get("label")});t.extend(n.getPosition()),n.addListener("click",function(){new google.maps.InfoWindow({content:'<a href="'+e.get("url")+'" target="_blank">'+e.get("dateTime")+" @ "+e.get("address")+": "+e.get("label")+"</a>"}).open(this.map,n)}.bind(this)),this.markers.push(n)}.bind(this)),!this.mapMoved&&this.props.news.models.length&&(this.fittingBounds=!0,this.map.fitBounds(t),this.fittingBounds=!1),this.mapMoved=!1}},fetchDataForNewBounds:function(){this.mapMoved=!0;var t=this.map.getBounds(),e=t.getNorthEast(),n=t.getSouthWest();this.props.news.mapBounds={left:n.lng(),right:e.lng(),top:e.lat(),bottom:n.lat()},this.props.news.loc=void 0,this.props.news.fetch()}})}),define("components/report",["react","utils/css","utils/color"],function(t,e,n){return t.createClass({getInitialState:function(){return e.load("report"),{}},render:function(){return t.createElement("div",{id:"mr-report"},this.props.news.models.map(function(e){return t.createElement("div",{className:"mr-report-article",style:{backgroundColor:"#"+e.get("colorHex")}},t.createElement("img",{src:e.get("icon")}),t.createElement("a",{href:e.get("url"),target:"_blank"},t.createElement("p",null),e.get("dateTime"),": ",e.get("label"),t.createElement("p",null)))}))}})}),define("router",["backbone"],function(t){return new(Backbone.Router.extend({initialize:function(){var t="pushState"in history;Backbone.history.start({pushState:t,hashChange:t})},routes:{"*path":"homePage"},homePage:function(t){this.rootDomain=document.domain+":8080",this.pathPrefix=-1===document.domain.indexOf("amazon")?"/mapreport-stable/":"/mapreport/";var e,n=location.pathname.split("/"),o=n.indexOf("topic")+1;o&&o<n.length&&(e=n[o]);var i,s=n.indexOf("location")+1;s&&s<n.length&&(i=n[s]);var a,r=n.indexOf("date")+1;r&&r<n.length&&(a=n[r]);var c,l,p,d;_.each(location.search.slice(1).split("&"),function(t){var e=t.split("=");"left"===e[0]?c=e[1]:"right"===e[0]?l=e[1]:"top"===e[0]?p=e[1]:"bottom"===e[0]&&(d=e[1])}),this.settings={topic:e,loc:i,date:a},c&&l&&p&&d&&(this.settings.mapBounds={left:c,right:l,top:p,bottom:d})},redirectTo:function(t){location.href=t},navigateTo:function(t){this.navigate(this.pathPrefix+t)}}))}),define("components/page",["react","utils/detector","collections/news","components/options","components/map","components/report","router"],function(t,e,n,o,i,s,a){return t.createClass({getInitialState:function(){return window.page=this,new n("http://"+a.rootDomain+a.pathPrefix,a.settings).on("sync",function(t){this.setState({loading:t.fetches,news:t,latitude:37.759753,longitude:-122.50232699999998})}.bind(this)).on("request",function(){this.setState({loading:!0})}.bind(this)),{loading:!0}},render:function(){return t.createElement("div",{id:"mr-buckets",className:e.phone()?"mobile":"desktop"},t.createElement(o,{news:this.state.news,loading:this.state.loading}),t.createElement(i,{news:this.state.news,latitude:this.state.latitude,longitude:this.state.longitude,loading:this.state.loading}),t.createElement("div",{id:"mr-report-bucket"},this.state.loading?"LOADER":t.createElement(s,{news:this.state.news})))}})}),requirejs.config({paths:{jquery:"//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min",jquerycolor:"//cdnjs.cloudflare.com/ajax/libs/jquery-color/2.1.2/jquery.color.min",underscore:"//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min",backbone:"//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min",react:"//cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react.min",mobiledetect:"//cdnjs.cloudflare.com/ajax/libs/mobile-detect/0.4.0/mobile-detect.min",gmaps:"//maps.googleapis.com/maps/api/js?key=AIzaSyCH89LosFbZ6Inmy5T8yCL0ao54qf2htCo&callback=initMap"},shim:{jquerycolor:{deps:["jquery"],exports:"jquerycolor"}}}),requirejs(["jquery","react","components/page"],function(t,e,n){e.render(e.createElement(n),t("body")[0])}),define("mapreport",function(){});